# Software Design Document 300 | Fourier Series Synthesis on K22F

## Overview
The scope of this document is limeted to describing the theoretical modeling of a Fourier series synthesizer that generates arbitrary periodic waveforms using truncated harmonic summation.

## Parameters


---

## Mathematical Foundation

### Base Signal Definition

$$
x(t) = \begin{cases}
0 & -20 \leq t < -(B + 10) \\
-t/(B + 10) & -(B + 10) \leq t < 0 \\
2t/(A + 10) & 0 \leq t < A + 10 \\
0 & A + 10 \leq t < 20 \\
x(t + 40) & \forall
\end{cases}
$$

Given:
- **A = 1**
- **B = 3**
In MATLAB
```matlab
A = 1;
B = 3;

t = -20:0.01:20;

x = zeros(size(t));

x(t >= -(B+10) & t < 0)       = -t(t >= -(B+10) & t < 0) / (B+10);
x(t >= 0 & t < (A+10))        = 2*t(t >= 0 & t < (A+10)) / (A+10);

plot(t, x);
title('x(t)');
xlabel('t');
grid on;
```
![Alt text](./Artifacts/SDD_301_Artifact_1.png "Figure 1")

### Signal Characteristics
- **Period:** T = 40 seconds (theoretical)
- **Fundamental frequency:** f₀ = 1/T = 0.025 Hz (theoretical)
- **Piecewise linear:** Two ramp segments with different slopes
- **DC component:** Non-zero (signal not symmetric about zero)

### Transformed Signal
The output signal is defined as:

$$
y(t) = c_{1} + c_{2} x(c_{3} t)
$$

Where:
- c₁ = DC offset for centering
- c₂ = Amplitude scaling
- c₃ = Time scaling (frequency multiplication)

### Fourier Series Representation
The truncated Fourier series approximation:

$$
y_{K}(t) = \sum_{k=-K}^{K} Y_k e^{jk\omega_{0} t}
$$

For real signals, this can be rewritten as:

$$
y_{K}(t) = Y_0 + 2\sum_{k=1}^{K} |Y_{k}| \cos(k\omega_{0} t + \phi_{k})
$$

Or equivalently:

$$
y_{K}(t) = a_{0} + \sum_{k=1}^{K} [a_{k} \cos(k\omega _{0} t) + b_{k} \sin(k \omega_{0} t)]
$$

---

## Part (a): Signal Visualization

### MATLAB Implementation
```matlab


```

---

## Part (b): Scaling Constants c₁ and c₂

### Objective
Maximize output amplitude while preventing saturation on 12-bit DAC (0-4095 range).

### Analysis
The K22F DAC requires:
- **Output range:** 0 to 4095 (12-bit unsigned)
- **Voltage range:** 0 to 3.3V
- **Recommended buffer:** ~10% headroom to prevent clipping

**DC offset (c₁):**
```
c₁ = 4095/2 = 2047.5 ≈ 2048
```
Centers the signal at mid-scale.

**Amplitude scaling (c₂):**

Given that x(t) has maximum value max(x) and minimum value min(x), the peak-to-peak amplitude is:
```
A_pp = max(x) - min(x)
```

With 10% headroom:
```
c₂ = 0.9 × (4095/2) / max(|x(t)|)
c₂ ≈ 1840 / max(|x(t)|)
```

**Result:**
- c₁ = 2048
- c₂ = [CALCULATE BASED ON YOUR A, B VALUES]

---

## Part (c): Frequency Scaling c₃

### Constraints
- **Sample rate:** Fs = 10 kHz
- **Nyquist frequency:** Fs/2 = 5 kHz
- **Signal quality:** Must maintain acceptable waveform for K ≤ 10

### Analysis
The highest frequency component in yK(t) is:
```
f_max = K × f₀ × c₃
```

For adequate reconstruction with K=10 harmonics, we need significant margin below Nyquist:
```
10 × f₀ × c₃ < 0.8 × (Fs/2)  [80% of Nyquist as safety margin]
10 × (1/40) × c₃ < 4000
c₃ < 16000
```

However, for better signal quality with K=1 (fundamental only), we want the base frequency high enough to be audible/visible:
```
f₀ × c₃ > 100 Hz  [reasonable lower bound]
c₃ > 4000
```

**Recommended value:**
```
c₃ = 8000-12000  [adjust based on MATLAB testing]
```

This gives:
- Fundamental: 200-300 Hz (K=1)
- 10th harmonic: 2-3 kHz (K=10)

---

## Part (d): Fourier Series Coefficients

### Derivation
For a periodic signal with period T, the Fourier series coefficients are:

$$
Y_k = \frac{1}{T} \int_{0}^{T} y(t) e^{-jk\omega_0 t} dt
$$

Since y(t) = c₁ + c₂x(c₃t), and x(t) is piecewise linear:

**DC component (k=0):**
$$
Y_0 = c_1 + \frac{c_2}{T} \int_{0}^{T} x(c_3 t) dt
$$

**Harmonic components (k≠0):**

For the piecewise segments, integration by parts:
$$
\int t e^{-j\omega t} dt = \frac{t}{-j\omega} e^{-j\omega t} - \frac{1}{-j\omega} \int e^{-j\omega t} dt
$$

$$
= \frac{-jt}{\omega} e^{-j\omega t} + \frac{1}{\omega^2} e^{-j\omega t}
$$


